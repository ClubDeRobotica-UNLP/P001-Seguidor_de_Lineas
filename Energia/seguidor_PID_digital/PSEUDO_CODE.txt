FLUJO CODIGO:

	- VARIABLES: 
		
		KP, KD, VEL_MAX, VEL, DT
		LAST_ERROR, ERROR, CONSTANTES[4]
		VEL_FILTRADA_ANT, VEL_FILTRADA

	- SETUP: 

		INIT: SERIAL INIT, LEDS INIT, LED_SENSORES_INIT, MOTORES INIT
		BOTON_RACE INIT, BOTON_MODE INIT

		FUNC: APAGAR MOTORES, SELECCIONAR_MODO (RAPIDO, SEGURO)

	  END

	- LOOP:
			
		SI BOTON_RACE = 0

			FLAG = !FLAG;

		END

		SI FLAG = 1

			SI dt > DT

				CALC_VEL_FILTRADA
				CAMBIO_VELOCIDAD

		END

	  END

	
CALC_VEL_FILTRADA
	
	DEFINIR ERRORES (CASOS POSIBLES)

	SWITCH (CASO)

		CASO ADELANTE: 00100

			ERROR = ERROR_CASO_ADELANTE
			CASO_ANT = 00100;
			

		CASO SIN PISTA: 00000

			IF (CASO_ANT == A || CASO_ANT == B || ...)

				FRENAR_GIRAR_DERECHA

			IF (CASO_ANT == A || CASO_ANT == B || ...)

				FRENAR_GIRAR_IZQUIERDA

		CASO Z:

	END

	VEL_FILTRADA_ANT = VEL_FILTRADA

	VEL_FILTRADA = (ERROR - ERROR_ANT)KD + ERROR KP

	VEL_M1_ANT = VEL_M1
	VEL_M2_ANT = VEL_M2

	VEL_M1 = VEL - VEL_FILTRADA
	VEL_M2 = VEL + VEL_FILTRADA

	IF (VEL_M1 > VEL_MAX) VEL_M1 = VEL_MAX
	IF (VEL_M2 > VEL_MAX) VEL_M2 = VEL_MAX
	IF (VEL_M1 < -VEL_MAX) VEL_M1 = -VEL_MAX
	IF (VEL_M2 < -VEL_MAX) VEL_M2 = -VEL_MAX


END



CAMBIO_VELOCIDAD(VEL_M1_ANT, VEL_M2_ANT, VEL_M1, VEL_M2)


	I

	IF(VEL_M1 > VEL_M1_ANT)

		FOR(int k = VEL_M1_ANT ; k <= VEL_M1 ; k = k + 5)

			ANALOG_WRITE(M1,k);
			ANALOG_WRITE(M2,k);
	
		END

	IF ELSE (VEL_FILTRADA_POSTERIOR < VEL_FILTRADA_ANTERIOR)

		FOR(int k = VEL_FILTRADA_ANTERIOR;k >= VEL_FILTRADA_POSTERIOR;k=k-5)

			SEGUIR_LINEA(k);
	
		END	

	ELSE

			SEGUIR_LINEA(VEL_FILTRADA_POSTERIOR)

	END	


END

		









